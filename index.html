<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="api" href="api.html">
        <link rel="prefetch" href="_static/light-logo.svg" as="image">
        <link rel="prefetch" href="_static/dark-logo.svg" as="image">

    <link rel="shortcut icon" href="_static/favicon.ico"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Aind Physiology Fip</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">Aind Physiology Fip</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/light-logo.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/dark-logo.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Aind Physiology Fip</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Welcome to the Aind Physiology Fip project documentation!</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">api</a><input aria-label="Toggle navigation of api" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api.session.html">api.session</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.rig.html">api.rig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="json-schemas.html">json-schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Data Contract</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AllenNeuralDynamics/Aind.Physiology.Fip">GitHub Source Code</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="welcome-to-the-aind-physiology-fip-project-documentation">
<h1>Welcome to the Aind Physiology Fip project documentation!<a class="headerlink" href="#welcome-to-the-aind-physiology-fip-project-documentation" title="Link to this heading">¶</a></h1>
</section>
<section id="fiber-photometry-system-configuration">
<h1>Fiber Photometry System Configuration<a class="headerlink" href="#fiber-photometry-system-configuration" title="Link to this heading">¶</a></h1>
<a class="reference external image-reference" href="https://github.com/AllenNeuralDynamics/Aind.Physiology.Fip/actions/workflows/aind-physiology-fip.yml/badge.svg"><img alt="CI" src="https://github.com/AllenNeuralDynamics/Aind.Physiology.Fip/actions/workflows/aind-physiology-fip.yml/badge.svg" />
</a>
<a class="reference external image-reference" href="https://pypi.org/project/aind-physiology-fip/"><img alt="PyPI - Version" src="https://img.shields.io/pypi/v/aind-physiology-fip" />
</a>
<a class="reference external image-reference" href="LICENSE"><img alt="License" src="https://img.shields.io/badge/license-MIT-brightgreen" />
</a>
<a class="reference external image-reference" href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json" />
</a>
<a class="reference external image-reference" href="https://github.com/astral-sh/uv"><img alt="uv" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/uv/main/assets/badge/v0.json" />
</a>
<p>For FIP photometry data acquisition and hardware control.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The FIP (Frame-projected Independent Photometry) system is a low-cost, scalable photometry setup designed for chronic recording of optical signals from behaving mice during daily training. The system is based on a modified design of Frame-projected Independent Photometry (Kim et al., 2016), using inexpensive, commercially available, off-the-shelf components.</p>
<a class="reference external image-reference" href="assets/images/fip_light_path.png"><img alt="FIP System Light Path" src="assets/images/fip_light_path.png" />
</a>
<p>For more information, see the <a class="reference external" href="https://www.allenneuraldynamics.org/platforms/fiber-photometry">AIND Fiber Photometry Platform Page</a> and the following protocols:</p>
<ul class="simple">
<li><p>Protocol for system assembly: <a class="reference external" href="https://www.protocols.io/view/modified-frame-projected-independent-fiber-photome-261ge39edl47/v2">https://www.protocols.io/view/modified-frame-projected-independent-fiber-photome-261ge39edl47/v2</a></p></li>
<li><p>Protocol for system triggering setup: <a class="reference external" href="https://www.protocols.io/view/modified-frame-projected-independent-fiber-photome-261ge39edl47/v2">https://www.protocols.io/view/modified-frame-projected-independent-fiber-photome-261ge39edl47/v2</a></p></li>
</ul>
</section>
<section id="wavelength-information">
<h2>Wavelength Information<a class="headerlink" href="#wavelength-information" title="Link to this heading">¶</a></h2>
<p>The table below summarizes the photometry system’s optical configuration, showing the relationship between emission channels and their corresponding excitation sources.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Excitation</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"><p>Emission</p></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Name</strong></p></td>
<td><p><strong>Wavelength (nm)</strong></p></td>
<td><p><strong>Led Name</strong></p></td>
<td></td>
<td><p><strong>name</strong></p></td>
<td><p><strong>Wavelength (nm)</strong></p></td>
<td><p><strong>Detector Name</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Yellow</p></td>
<td><p>565</p></td>
<td><p>565 nm LED</p></td>
<td></td>
<td><p>Red</p></td>
<td><p>~590 (peak)</p></td>
<td><p>Red CMOS</p></td>
</tr>
<tr class="row-even"><td><p>Blue</p></td>
<td><p>470</p></td>
<td><p>470 nm LED</p></td>
<td></td>
<td><p>Green</p></td>
<td><p>~510 (peak)</p></td>
<td><p>Green CMOS</p></td>
</tr>
<tr class="row-odd"><td><p>UV</p></td>
<td><p>415</p></td>
<td><p>415 nm LED</p></td>
<td></td>
<td><p>Isosbestic</p></td>
<td><p>490-540 (passband)</p></td>
<td><p>Green CMOS</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="signal-detection">
<h2>Signal Detection<a class="headerlink" href="#signal-detection" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Green Channel</strong>: Primarily used for green GFP based indicators</p></li>
<li><p><strong>Red Channel</strong>: Primarily used for RFP-based indicators (e.g., RdLight)</p></li>
<li><p><strong>Isosbestic Channel</strong>: Used as a control measurement; shares same emission path as green but with different excitation</p></li>
</ul>
<p>The system uses dedicated CMOS cameras for the red and green emissions, with the isosbestic signal being captured by the green camera under different excitation conditions.</p>
</section>
<section id="temporal-multiplexing">
<h2>Temporal Multiplexing<a class="headerlink" href="#temporal-multiplexing" title="Link to this heading">¶</a></h2>
<p>The system employs temporal multiplexing to acquire signals from multiple fluorescent indicators through the same optical fiber. This is achieved by rapidly cycling through different excitation wavelengths while synchronizing camera acquisitions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>            ---&gt;|              |&lt;--- period = 16.67 ms
Blue LED(470)   ████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░

UV LED (415)    ░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░

Yellow LED (560)░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░

Green CMOS      ████░████░░░░░░████░████░░░░░░████░████░░░░░░████░████░░░░░░████░████░░░░░░  (captures 470/415)
Red CMOS        ░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░░░░░░░░░░░████░  (captures 560)
                ───────────────────────────────────────────────────────────────────────────►
                                    Time
</pre></div>
</div>
<p>The temporal multiplexing sequence:</p>
<ol class="arabic simple">
<li><p>Blue LED (470nm) excitation -&gt; Green CMOS camera captures signal from GFP-based sensors</p></li>
<li><p>UV LED (415nm) excitation -&gt; Green CMOS camera captures isosbestic signal</p></li>
<li><p>Yellow LED (560nm) excitation -&gt; Red CMOS camera captures signal from RFP-based sensors</p></li>
</ol>
<p>This cycling occurs at 60 Hz, allowing near-simultaneous measurement of multiple signals while preventing crosstalk between channels. Each LED is activated in sequence and cameras are synchronized to capture data only during their respective LED’s ON period.</p>
</section>
<section id="using-the-acquisition-system">
<h2>Using the acquisition system<a class="headerlink" href="#using-the-acquisition-system" title="Link to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/AllenNeuralDynamics/Aind.Physiology.Fip/wiki">wiki</a> for AIND internal installation instructions.</p>
<section id="pre-requisites-some-of-these-are-optional-but-recommended-for-a-smoother-experience">
<h3>Pre-requisites (some of these are optional, but recommended for a smoother experience)<a class="headerlink" href="#pre-requisites-some-of-these-are-optional-but-recommended-for-a-smoother-experience" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://code.visualstudio.com/">Visual Studio Code</a> (highly recommended for editing code scripts and git commits)</p></li>
<li><p><a class="reference external" href="https://gitforwindows.org/">Git for Windows</a> (highly recommended for cloning and manipulating this repository)</p></li>
<li><p><a class="reference external" href="https://dotnet.microsoft.com/download/dotnet-framework/thank-you/net472-developer-pack-offline-installer">.NET Framework 4.7.2 Developer Pack</a> (required for intellisense when editing code scripts)</p></li>
<li><p><a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=30679">Visual C++ Redistributable for Visual Studio 2012</a> (native dependency for OpenCV)</p></li>
<li><p><a class="reference external" href="https://www.teledynevisionsolutions.com/support/support-center/software-firmware-downloads/iis/spinnaker-sdk-download/spinnaker-sdk--download-files/#anchor6">Spinnaker SDK 1.29.0.5</a> (device drivers for FLIR cameras)</p></li>
<li><p>On FLIR website: <code class="docutils literal notranslate"><span class="pre">Download</span> <span class="pre">&gt;</span> <span class="pre">archive</span> <span class="pre">&gt;</span> <span class="pre">1.29.0.5</span> <span class="pre">&gt;</span> <span class="pre">SpinnakerSDK_FULL_1.29.0.5_x64.exe</span></code></p></li>
<li><p>[Optional] <a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation/">UV Python environment manager</a> (highly recommended for managing the Python environment for this project. All examples will assume usage of <code class="docutils literal notranslate"><span class="pre">uv</span></code>. Alternatively, you can use other environment managers such as <code class="docutils literal notranslate"><span class="pre">venv</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span></code> to create a Python environment and install the required dependencies listed in the package metadata: <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>)</p></li>
</ul>
</section>
<section id="installation-steps">
<h3>Installation Steps<a class="headerlink" href="#installation-steps" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Clone this repository</p></li>
<li><p>Create the environments for Bonsai, run <code class="docutils literal notranslate"><span class="pre">./bonsai/setup.cmd</span></code> (can be by double-clickin it too). This is required to run experiments using the Bonsai script in an experimental PC.</p></li>
<li><p>[Optional] Create the environments for Python, run <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">venv</span></code> if using uv, or create a virtual environment using your preferred method. This is only used to run the Python script generating configuration files. (rig PCs can inherit those files from somewhere else)</p></li>
</ol>
<ul class="simple">
<li><p>Alternatively, if you are using uv, run <code class="docutils literal notranslate"><span class="pre">./scripts/deploy.ps1</span></code> to bootstrap a Python and Bonsai environment at the same time for the project automatically.</p></li>
</ul>
</section>
<section id="generating-input-configurations-optional">
<h3>Generating input configurations [Optional]<a class="headerlink" href="#generating-input-configurations-optional" title="Link to this heading">¶</a></h3>
<p>The current pipeline relies on two input configuration files. These configure the rig/instruments and session parameters, respectively. These files are formalized as pydantic models as shown in <code class="docutils literal notranslate"><span class="pre">./examples/examples.py</span></code>. Template configuration files are included in the <code class="docutils literal notranslate"><span class="pre">./examples/</span></code> folder, and running the <code class="docutils literal notranslate"><span class="pre">examples.py</span></code> will create configuration files into  <code class="docutils literal notranslate"><span class="pre">./local/</span></code></p>
<p>Briefly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">aind_behavior_services.session</span><span class="w"> </span><span class="kn">import</span> <span class="n">AindBehaviorSessionModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">aind_physiology_fip.rig</span><span class="w"> </span><span class="kn">import</span> <span class="n">AindPhysioFipRig</span>

<span class="n">this_rig</span> <span class="o">=</span> <span class="n">AindPhysioFipRig</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">this_session</span> <span class="o">=</span> <span class="n">AindBehaviorSessionModel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="n">this_session</span><span class="p">,</span> <span class="n">this_rig</span><span class="p">]:</span>
 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="running-the-acquisition">
<h3>Running the acquisition<a class="headerlink" href="#running-the-acquisition" title="Link to this heading">¶</a></h3>
<section id="running-manually">
<h4>Running manually<a class="headerlink" href="#running-manually" title="Link to this heading">¶</a></h4>
<p>Acquisition is done through Bonsai via a single entry-point workflow. As any Bonsai workflow, one can run the acquisition workflow via the editor:</p>
<ul class="simple">
<li><p>Open Bonsai from the bootstrapped environment in <code class="docutils literal notranslate"><span class="pre">./bonsai/bonsai.exe</span></code></p></li>
<li><p>Open the workflow file <code class="docutils literal notranslate"><span class="pre">./src/main.bonsai</span></code></p></li>
<li><p>Manually set the two highest level properties <code class="docutils literal notranslate"><span class="pre">RigPath</span></code> and <code class="docutils literal notranslate"><span class="pre">SessionPath</span></code> to the paths of the configuration files generated in the <span class="xref std std-ref">previous step</span>.</p></li>
<li><p>Launch the workflow by clicking the “Run” button in the Bonsai editor.</p></li>
<li><p>Settings in FipRig.json such as <code class="docutils literal notranslate"><span class="pre">camera_green_iso</span></code> <code class="docutils literal notranslate"><span class="pre">serial_number</span></code> and <code class="docutils literal notranslate"><span class="pre">cuttlefish_fip</span></code> <code class="docutils literal notranslate"><span class="pre">port_name</span></code> needs to be modified per PC for Bonsai to detect those hardware.</p></li>
</ul>
<blockquote>
<div><p>[!Important]
<code class="docutils literal notranslate"><span class="pre">AindBehaviorSessionModel.allow_dirty</span></code> property will be checked at the start of the workflow. If set to <code class="docutils literal notranslate"><span class="pre">False</span></code> the workflow will immediately throw an error and stop execution if the repository has uncommitted changes. If the user intends to run the workflow with a dirty repository, they should set this property to <code class="docutils literal notranslate"><span class="pre">True</span></code> in the session configuration file.</p>
</div></blockquote>
</section>
<section id="running-via-cli">
<h4>Running via CLI<a class="headerlink" href="#running-via-cli" title="Link to this heading">¶</a></h4>
<p>The workflow can be launched via the Bonsai Command Line Interface (CLI). Additional documentation on the CLI can be found <a class="reference external" href="https://bonsai-rx.org/docs/articles/cli.html">here</a>.
To run the acquisition workflow using the CLI, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;./bonsai/bonsai.exe&quot;</span><span class="w"> </span><span class="s2">&quot;./src/main.bonsai&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="nv">RigPath</span><span class="o">=</span><span class="s2">&quot;../path/to/rig.json&quot;</span><span class="w"> </span>-p<span class="w"> </span><span class="nv">SessionPath</span><span class="o">=</span><span class="s2">&quot;../path/to/session.json&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p>[!Note]
The paths to the configuration file are relative to the workflow working directory (i.e. <code class="docutils literal notranslate"><span class="pre">./src/</span></code>)</p>
</div></blockquote>
<p>Additional flags can be passed to automatically start the workflow (<code class="docutils literal notranslate"><span class="pre">--start</span></code>) or run in headless mode (<code class="docutils literal notranslate"><span class="pre">--no-editor</span></code>) as stated in the Bonsai CLI documentation.</p>
</section>
<section id="acquiring-data">
<h4>Acquiring data<a class="headerlink" href="#acquiring-data" title="Link to this heading">¶</a></h4>
<p>Once the workflow is running, a UI will pop up and users can start acquisition by clicking <code class="docutils literal notranslate"><span class="pre">Start</span></code>. The system will then begin to acquire data from the cameras and store it in the specified session directory. Once the session is ready to stop, users can click <code class="docutils literal notranslate"><span class="pre">Stop</span></code> in the UI. The system will then save the session data and stop/close the workflow.</p>
</section>
</section>
</section>
<section id="contributors">
<h2>Contributors<a class="headerlink" href="#contributors" title="Link to this heading">¶</a></h2>
<p>Contributions to this repository are welcome! However, please ensure that your code adheres to the recommended DevOps practices below:</p>
<section id="linting">
<h3>Linting<a class="headerlink" href="#linting" title="Link to this heading">¶</a></h3>
<p>We use <a class="reference external" href="https://docs.astral.sh/ruff/">ruff</a> as our primary linting tool:.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>format<span class="w"> </span>.
uv<span class="w"> </span>run<span class="w"> </span>ruff<span class="w"> </span>check<span class="w"> </span>.
</pre></div>
</div>
</section>
<section id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h3>
<p>Attempt to add tests when new features are added.
To run the currently available tests, run <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">run</span> <span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span></code> from the root of the repository.</p>
</section>
<section id="lock-files">
<h3>Lock files<a class="headerlink" href="#lock-files" title="Link to this heading">¶</a></h3>
<p>We use <a class="reference external" href="https://docs.astral.sh/uv/">uv</a> to manage our lock files and therefore encourage everyone to use uv as a package manager as well.</p>
</section>
</section>
<section id="cli">
<h2>CLI<a class="headerlink" href="#cli" title="Link to this heading">¶</a></h2>
<p>The package provides a command line interface (CLI) to facilitate common tasks. The CLI can be accessed by running the following command from the root of the repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>run<span class="w"> </span>fip<span class="w"> </span>&lt;subcommand&gt;<span class="w"> </span><span class="o">[</span>options<span class="o">]</span>
</pre></div>
</div>
<p>For a list of available subcommands and options, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>run<span class="w"> </span>fip<span class="w"> </span>--help
</pre></div>
</div>
<p>(If you are not using <code class="docutils literal notranslate"><span class="pre">uv</span></code>, activate your python environment and run the <code class="docutils literal notranslate"><span class="pre">fip</span></code> tool directly.)</p>
</section>
<section id="regenerating-schemas">
<h2>Regenerating schemas<a class="headerlink" href="#regenerating-schemas" title="Link to this heading">¶</a></h2>
<p>Instructions for regenerating schemas can be found <a class="reference external" href="https://github.com/AllenNeuralDynamics/Aind.Behavior.Services?tab=readme-ov-file#regenerating-schemas">here</a>.</p>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Welcome to the Aind Physiology Fip project documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">api</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.session.html">api.session</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.rig.html">api.rig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="json-schemas.html">json-schema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="json-schemas.html#rig-schema">Rig Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Data Contract</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/AllenNeuralDynamics/Aind.Physiology.Fip">GitHub Source Code</a></li>
</ul>
</div>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">api</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=92734c54"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>